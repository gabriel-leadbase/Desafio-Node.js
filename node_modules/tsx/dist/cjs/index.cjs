"use strict";var u=require("path"),S=require("fs"),a=require("module"),l=require("get-tsconfig"),g=require("../source-map.cjs"),m=require("../index-bb73d2cd.cjs"),j=require("../resolve-ts-path-3fca13b7.cjs");require("url"),require("esbuild"),require("crypto"),require("os");const E=s=>{if(s.includes("import")||s.includes("export"))try{const[e,n]=m.parseEsm(s);return e.length>0||n.length>0}catch{return!0}return!1},O=/^\.{1,2}\//,P=/\.[cm]?tsx?$/,M=`${u.sep}node_modules${u.sep}`,f=process.env.TSX_TSCONFIG_PATH?{path:u.resolve(process.env.TSX_TSCONFIG_PATH),config:l.parseTsconfig(process.env.TSX_TSCONFIG_PATH)}:l.getTsconfig(),h=f&&l.createFilesMatcher(f),_=f&&l.createPathsMatcher(f),x=g.installSourceMapSupport(),d=a._extensions,q=d[".js"],A=[".cts",".mts",".ts",".tsx",".jsx"],N=[".js",".cjs",".mjs"],y=(s,e)=>{process.send&&process.send({type:"dependency",path:e});const n=A.some(r=>e.endsWith(r)),o=N.some(r=>e.endsWith(r));if(!n&&!o)return q(s,e);let t=S.readFileSync(e,"utf8");if(e.endsWith(".cjs")){const r=m.transformDynamicImport(e,t);r&&(t=x(r))}else if(n||E(t)){const r=m.transformSync(t,e,{tsconfigRaw:h==null?void 0:h(e)});t=x(r)}s._compile(t,e)};[".js",".ts",".tsx",".jsx"].forEach(s=>{d[s]=y}),Object.defineProperty(d,".mjs",{value:y,enumerable:!1});const v=a._resolveFilename.bind(a);a._resolveFilename=(s,e,n,o)=>{var t;const r=s.indexOf("?");if(r!==-1&&(s=s.slice(0,r)),_&&!O.test(s)&&!((t=e==null?void 0:e.filename)!=null&&t.includes(M))){const i=_(s);for(const T of i){const p=F(T,e,n,o);if(p)return p;try{return v(T,e,n,o)}catch{}}}const c=F(s,e,n,o);return c||v(s,e,n,o)};const F=(s,e,n,o)=>{const t=j.resolveTsPath(s);if(e!=null&&e.filename&&P.test(e.filename)&&t)for(const r of t)try{return v(r,e,n,o)}catch(c){const{code:i}=c;if(i!=="MODULE_NOT_FOUND"&&i!=="ERR_PACKAGE_PATH_NOT_EXPORTED")throw c}};
